import{useEffect as _,useReducer as w,useRef as R}from"react";var y=s=>s+1;function x({init:s,reducer:u}){let r=new Map,o=new Map,c={_state:s,get state(){return this._state},set state(e){this._state=e;for(let[t,n]of r.entries()){if(!n)continue;let f=o.get(t),S=t(this._state);S!=f&&(o.set(t,S),n())}}};function l(){return c.state}async function a(e){let t=await u(e,l,a);c.state=t}function d(e){r.delete(e),o.delete(e)}function p(e){let t=R(e),[,n]=w(y,0),f=t.current(c.state);return r.set(t.current,n),_(()=>()=>d(t.current),[]),f}return[a,p,l]}var m="__REDUX_DEVTOOLS_EXTENSION__",i=(()=>{try{return window[m]||window.top[m]}catch(s){return}})(),O=0;function v({init:s,reducer:u,name:r,replacer:o,reviver:c}){return i?(i.connect({name:r||`ProxyState ${O++}`,serialize:{replacer:o,reviver:c},features:{persist:!1,export:!0,import:"custom",jump:!1,skip:!1,reorder:!1,dispatch:!0,test:!0}}),i.send("__INIT__",s),{reducer:async(a,d,p)=>{let e=new Date().toISOString(),t=u(a,d,p),n=await t;return t instanceof Promise?i.send({...a,__startTime:e,__endTime:new Date().toISOString()},n):i.send(a,t),t},init:s}):{reducer:u,init:s}}export{v as addDevtools,x as createState};
